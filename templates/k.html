<!DOCTYPE html>
<!--feef-->
<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>DroneTools</title>

    <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"> -->
	<link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <script src="/static/js/jquery-3.6.0.min.js"></script>

    <style>

        .circle {

            width: 50px;

            height: 50px;

            border-radius: 50%;

            background-color: #007bff;

            display: flex;

            justify-content: center;

            align-items: center;

            color: white;

        }



        .color-rect {

            height: 10px;

            border: 1px solid #000;

        }



        .flex-center {

            display: flex;

            justify-content: center;

            align-items: center;

            gap: 10px;

        }

		.texto-pequeno {

			font-size: 14px;

		}

        .estado-container {

            display: flex;

            justify-content: space-around;

            margin-bottom: 20px;

        }

        .margen-personalizado {

            margin: 20px;

            background-color: #ffffff;

            padding: 20px; 

        }

    </style>

</head>

<body>

    <div class="container mt-5">

        <h1 class="text-center">Página de configuración</h1>

        <p class="text-center">

            <a href="/calibration" class="btn btn-primary">Calibración</a>
			<a href="/calculos" class="btn btn-primary">Calculos</a>
        </p>

        <div class="margen-personalizado">

	

		</div>

        <div class="row">

            <div class="col-md-4">

                <h3>Selección de variables</h3>

                <form id="checkbox-form">

<!--
                    <input type="hidden" name="names" value="">
-->

                    {% for checkbox in checkboxes %}

						<div class="form-check mb-3">

							<input type="checkbox" id="{{ checkbox.name }}" name="names" value="{{ checkbox.name }}" {% if checkbox.checked %}checked{% endif %}>

							<label for="{{ checkbox.name }}" class="form-check-label">{{ checkbox.name }}</label><br>

						</div>

					{% endfor %}

                    <button type="submit" class="btn btn-primary">Guardar selección</button>

                </form>

				<div class="container mt-4">

				  <div class="row">

					<div class="col-md-12">

					  <div class="card">

						<div class="card-body">

						  <h5 class="card-title">Detalles de la Selección</h5>

						  <p class="card-text">

							<strong>Longitud de onda inicial en uso:</strong> <span id="rangoi" class="text-primary"></span>

						  </p>

						  <p class="card-text">

							<strong>Longitud de onda final en uso:</strong> <span id="rangof" class="text-primary"></span>

						  </p>

						  <p class="card-text">

							<strong>Variables en uso:</strong> <span id="var_sel" class="text-primary"></span>

						  </p>
						  <p class="card-text">
						    <strong>Nombre del archivo seleccionado:</strong> <span id="nombreArchivoSeleccionado" class="text-primary"></span>
						  </p>

						</div>

					  </div>

					</div>

				  </div>

				</div>



            </div>



            <div class="col-md-4">

				<form method="POST" action="/filter" class="text-center">

					<select name="option1" id="option1" onchange="validateRange()" class="mb-2">

						{% for item in desplegables %}

							<option value="{{ item }}" {% if item == option1 %} selected {% endif %}>{{ item }}</option>

						{% endfor %}

					</select>



					<select name="option2" id="option2" onchange="validateRange()" class="mb-2">

						{% for item in desplegables %}

							<option value="{{ item }}" {% if item == option2 %} selected {% endif %}>{{ item }}</option>

						{% endfor %}

					</select>



					<button type="button" class="btn btn-primary mx-auto d-block mb-3" id="submit-button" onclick="updateFilter()">Actualizar filtro</button>

				</form>



				<div class="text-center mb-3">

					<button id="start-recording" class="btn btn-primary mx-auto d-block">Iniciar registro</button>

				</div>
				
				<div class="text-center mb-3">
					
					<button id="save-configuration-button"  class="btn btn-primary mx-auto d-block">Guardar configuración</button>
				
				</div>

				
				
				<div class="text-center mb-3">
					
					<button id="default-button"  class="btn btn-primary mx-auto d-block">Valores por defecto</button>
				
				</div>


				<div class="text-center mb-3">

					<button id="clear-csv-btn" class="btn btn-primary mx-auto d-block">Limpiar base de datos</button>

				</div>



				<form action="/download_csv" method="get" class="text-center mb-3">

					<button type="submit" class="btn btn-primary mx-auto d-block">Descargar datos</button>

				</form>				
	

				<form id="tiempo_save" class="text-center">

					<div class="form-group p-3">

						<input type="text" class="form-control" id="numeroInput" aria-describedby="numeroHelp" placeholder="Intervalo de guardado en segundos">

						<small id="numeroHelp" class="form-text text-muted">Mínimo: 0.2 segundos</small>

						<input type="text" class="form-control" id="input_canula" aria-describedby="numeroHelp" placeholder="Distancia de la cánula en cm, mínimo 30 cm">


					</div>

					<button type="submit" class="btn btn-primary mx-auto d-block">Actualizar</button>

				</form>

				<div class="text-center">Número de registros: <span id="datos-guardados"></span></div>
				<div class="text-center">Distancia de la cánula (cm): <span id="span_longintud_canula"> {{longitud_canula_cm}}</span></div>
				<div class="text-center">Intervalo de guardado  (s) : <span id="tiempo-guardado"></span></div>

				<div class="text-center">Tiempo de integración de la cámara (ms): <span id="tiempo-integracion"></span></div>

				<button type="button" class="btn mx-auto d-block" data-bs-toggle="tooltip" data-bs-placement="top" title="Un tiempo de guardado cerca del mínimo puede llevar a retardos en alguna toma. El tiempo de integración de la cámara también afecta al tiempo de guardado"</button>

				<div class="text-center">⚠</div>

			</div>



            <div class="col-md-4">

				<h3 class="text-center">Luces de estado</h3>

                <div class="estado-container">

                    <div class="flex-center">

                        <div id="circle" class="circle"></div>

                        <div class="text-start">Estado GPS</div>

                    </div>



                    <div class="flex-center">

                        <div id="circle2" class="circle"></div>

                        <div class="text-start">Estado cámara</div>

                    </div>

                </div>

                  <div class="col text-center">
					  
					<div class="coltext-center">
						
							<div class="fw-bold">Fecha:</div>

							<div id="fecha" data-key="fecha"></div>
					</div>
					
					<div class="col text-center">
						
							<div class="fw-bold">Hora (UTC):</div>
							

							<div id="altitud" data-key="hora"></div>
							
					</div>
					
					<div class="row p-3">

						<div class="fw-bold">Precisión del GPS</div>

					</div>

					<div class="row">

						<div class="col text-center align-self-center">

							<div class="">Desviación Longitud</div>

							<div id="error_E" data-key="error_E"></div>

						</div>

						<div class="col text-center align-self-center">

							<div class="">Desviación Latitud</div>

							<div id="error_N" data-key="error_N"></div>

						</div>

						<div class="col text-center align-self-center">

							<div class="">Desviación Altitud</div>

							<div id="error_U" data-key="error_U"></div>

						</div>

					</div>

					<div class="row">

						<div class="col-4 color-rect" id="rect11"></div>

						<div class="col-4 color-rect" id="rect12"></div>

						<div class="col-4 color-rect" id="rect13"></div>

					</div>

					<div class="row">

						<div class="col-4 color-rect" id="rect21"></div>

						<div class="col-4 color-rect" id="rect22"></div>

						<div class="col-4 color-rect" id="rect23"></div>

					</div>

					<div class="row">

						<div class="col-4 color-rect" id="rect31"></div>

						<div class="col-4 color-rect" id="rect32"></div>

						<div class="col-4 color-rect" id="rect33"></div>

					</div>

					<div class="row">

						<div class="col-4 color-rect" id="rect41"></div>

						<div class="col-4 color-rect" id="rect42"></div>

						<div class="col-4 color-rect" id="rect43"></div>

					</div>

					<div class="row">

						<div class="col-4 color-rect" id="rect51"></div>

						<div class="col-4 color-rect" id="rect52"></div>

						<div class="col-4 color-rect" id="rect53"></div>

					</div>

					<div class="row">

						<div class="col-4 color-rect" id="rect61"></div>

						<div class="col-4 color-rect" id="rect62"></div>

						<div class="col-4 color-rect" id="rect63"></div>

					</div>

					<div class="row">

						<div class="col-4 text-center">

							<div class="fw-bold">Longitud:</div>

							<div id="longitud" class="texto-pequeno" data-key="longitud"></div>

						</div>

						<div class="col-4 text-center">

							<div class="fw-bold">Latitud:</div>

							<div id="latitud" class="texto-pequeno" data-key="latitud"></div>

						</div>

						<div class="col-4 text-center">

							<div class="fw-bold">Altitud:</div>

							<div id="altitud" class="texto-pequeno" data-key="altitud"></div>

						</div>

					</div>

				</div>

				<form id="createCsvForm">

					<input type="text" id="fileName" name="fileName" placeholder="Nombre del archivo CSV" required>

					<button type="submit">Crear Archivo</button>

				</form>

				<select id="csvFileSelector">

					<option>Selecciona un archivo CSV</option>

				</select>

				<button id="deleteButton">Eliminar Archivo CSV Seleccionado</button>

				<div id="filtered-data" class="mt-3 text-start"></div>

            </div>

        </div>

    </div>

    <!--<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>-->

    <script>

		const distancia_canula_input = document.getElementById('input_canula');
		
		const span_longitud_canula_actual = document.getElementById('span_longintud_canula');
		
		const span_rando_inicial = document.getElementById('rangoi');
		
		const span_rando_final = document.getElementById('rangof');
		
		const span_tiempo_guardado = document.getElementById('tiempo-guardado');
		
		const span_tiempo_integracion = document.getElementById('tiempo-integracion');
		
		const select_rango_incial = document.getElementById('option1');
		
		const select_rango_final = document.getElementById('option2');
		

        const margen1 = 0.01;

        const margen2 = 2;

        const margen3 = 4;

        const margen4 = 6;

        const margen5 = 10;

        const margen6 = 20;



        const verde_osc = "#006400"

        const verde = "#008000"

        const verde_cl = "#00FF00"

        const amarillo = "#FFD700"

        const naranja = "#FFA500"

        const rojo = "#FF0000"

        const blanco = "#FFFFFF"



        const contentElement5 = document.getElementById('altitud');

        const contentElement6 = document.getElementById('latitud');

        const contentElement7 = document.getElementById('longitud');



        const contentElement9 = document.getElementById('error_N');

        const contentElement10 = document.getElementById('error_E');

        const contentElement11 = document.getElementById('error_U');
        
        
		function resestUIelementsDefaultValues(default_values){			
			span_longitud_canula_actual.textContent = default_values.longitud_canula_cm;
			
			span_rando_inicial.textContent = default_values.rango_inicial;
			
			span_rando_final.textContent = default_values.rando_final;
			
			span_tiempo_guardado.textContent = default_values.tiempo_guardado;
			
			span_tiempo_integracion.textContent = default_values.integration_time;
			
			select_rango_incial.value = default_values.rango_inicial;
			 
			select_rango_final.value = default_values.rango_final;
		}
		
		
		function drawServerReceivedMessage(message,isError=false){
			const div_aviso = document.getElementById('filtered-data');
			div_aviso.textContent = message
			div_aviso.classList.add("alert");
			let type_alert = "alert-success";
			if(isError){
				type_alert = "alert-warning";
			}
			div_aviso.classList.add(type_alert);
			setTimeout(function() {
					div_aviso.textContent  = "";
					div_aviso.classList.remove("alert");
					div_aviso.classList.remove(type_alert);
			}, 3000);
		}

		function fetchAndUpdateSelectedFile() {
			console.log("FetchAndUpdateSelectedFiles")
			fetch('/get_selected_file')
			.then(response => response.json())
			.then(data => {
				if (data.fileName) {
					document.getElementById('nombreArchivoSeleccionado').textContent = data.fileName;
					document.getElementById('csvFileSelector').value = data.fileName;
				}
			})
			.catch(error => console.error('Error:', error));
		}
		

        document.addEventListener('DOMContentLoaded', function() {
			console.log("DOM CONTENT LOADED EVENT TRIGGER: List Files")
			fetch('/list_csv_files')

				.then(response => response.json())

				.then(csvFiles => {

					const selector = document.getElementById('csvFileSelector');

					csvFiles.forEach(file => {

						const option = document.createElement('option');

						option.value = file;

						option.textContent = file;

						selector.appendChild(option);

					});
					
					fetchAndUpdateSelectedFile();
					
				})

				.catch(error => console.error('Error al listar archivos CSV:', error));

		});

		

		function addFileToDropdown(fileName) {

			const dropdown = document.getElementById('csvFileSelector');

			const newOption = document.createElement('option');

			newOption.value = fileName;

			newOption.textContent = fileName;

			dropdown.appendChild(newOption);
			
			dropdown.value = fileName;
			document.getElementById('nombreArchivoSeleccionado').textContent = fileName;
		}

		

		document.getElementById('createCsvForm').addEventListener('submit', function(e) {

			e.preventDefault();



			var fileName = document.getElementById('fileName').value;

			if (fileName.length === 0) {

				alert('Por favor, ingresa un nombre de archivo.');

				return;

			}



			fetch('/create_csv', {

				method: 'POST',

				headers: {

					'Content-Type': 'application/json',

				},

				body: JSON.stringify({ fileName: fileName }),

			})

			.then(response => response.json())

			.then(data => {

				console.log(data);

				alert(data.message);



				if(data.message && data.message.includes('creado exitosamente')) {

					addFileToDropdown(fileName + ".csv");

				}

			})

			.catch((error) => {

				console.error('Error:', error);

			});

		});
		
		document.getElementById('default-button').addEventListener('click',function(){
			fetch('/default_values',{method: 'POST'})
			.then(response => response.json())
			.then(response => {
				console.log(response.default_values);
				resestUIelementsDefaultValues(response.default_values);
				drawServerReceivedMessage(response.message);
			
			}).catch(error => console.error('Error en resetear a valores por defecto: ', error))
		});
		
		document.getElementById('save-configuration-button').addEventListener('click',function(){
			fetch('/save_configuration',{method:'POST'})
			.then(response => {
				if(response.status != 200) throw new Error('Error al intentar guardar los parámetros de configuración')
				return response.json()
				
			}).then(response => drawServerReceivedMessage(response.message))
			.catch(error => {
				console.error(error);
				drawServerReceivedMessage('Error al intentar guardar los parámetros de configuración',true);
			})
		});
		
		
		document.getElementById('csvFileSelector').addEventListener('change', function() {
			const selectedFile = this.value;
			console.log('Archivo CSV seleccionado:', selectedFile);
			fetch('/select_csv', {

				method: 'POST',

				headers: {

					'Content-Type': 'application/json',

				},

				body: JSON.stringify({fileName: selectedFile}),

			})

			.then(response => response.json())

			.then(data => {
				console.log(data)
				document.getElementById('nombreArchivoSeleccionado').textContent = data.current_selected_file
			})
		});

		document.getElementById('deleteButton').addEventListener('click', function() {

			const selectedFile = document.getElementById('csvFileSelector').value;

			if (selectedFile) {

				fetch('/delete_csv', {

					method: 'POST',

					headers: {

						'Content-Type': 'application/json',

					},

					body: JSON.stringify({ fileName: selectedFile }),

				})

				.then(response => response.json())

				.then(data => {

					console.log(data.message);

					document.getElementById('csvFileSelector').remove(document.getElementById('csvFileSelector').selectedIndex);

					alert(data.message);

				})

				.catch(error => console.error('Error:', error));

			} else {

				alert('Por favor, selecciona un archivo CSV para eliminar.');

			}

		});

        

        function updateDataElements(data) {

			document.querySelectorAll('[data-key]').forEach((element) => {

				const key = element.getAttribute('data-key');



				if (data[key] !== undefined) {

					if (key.startsWith('error')) {

						element.innerText = `${data[key]} m`;

					}else if (key === 'fecha' || key === 'hora') {
						
						element.innerText = data[key];
						
					}else {

						element.innerText = `${data[key]} ${key === 'altitud' ? 'm' : 'º'}`;

					}

				}

			});

		}	
		
		document.getElementById('tiempo_save').addEventListener('submit', function(event) {
            event.preventDefault(); 
            let numeroIntroducido = document.getElementById('numeroInput').value;
			let distancia_canula_value = distancia_canula_input.value;
			if(!numeroIntroducido || !distancia_canula_value || isNaN(numeroIntroducido) || isNaN(distancia_canula_value)
			|| numeroIntroducido < 0.2 || distancia_canula_value < 30){
					drawServerReceivedMessage("Debe introducir un valor correcto para el intervarlo y la distancia",true);
					return;
			} 
			const datos = [numeroIntroducido,distancia_canula_value]
			fetch('/tiempo_guardado',{
				method: 'POST',
				headers: {'Content-Type': 'application/json'},
				body: JSON.stringify(datos)
			})
			.then(response => response.json())
			.then(response => {
				drawServerReceivedMessage(response.filtered_data);
				span_longitud_canula_actual.textContent = response.valor_canula_actual
			})
			.catch(error => {console.error('Error updating white spectra data:', error);})
			
		});

        function datosGPS_colores() {

            var rect11 = document.getElementById("rect11");

            var rect21 = document.getElementById("rect21");

            var rect31 = document.getElementById("rect31");

            var rect41 = document.getElementById("rect41");

            var rect51 = document.getElementById("rect51");

            var rect61 = document.getElementById("rect61");



            var rect12 = document.getElementById("rect12");

            var rect22 = document.getElementById("rect22");

            var rect32 = document.getElementById("rect32");

            var rect42 = document.getElementById("rect42");

            var rect52 = document.getElementById("rect52");

            var rect62 = document.getElementById("rect62");



            var rect13 = document.getElementById("rect13");

            var rect23 = document.getElementById("rect23");

            var rect33 = document.getElementById("rect33");

            var rect43 = document.getElementById("rect43");

            var rect53 = document.getElementById("rect53");

            var rect63 = document.getElementById("rect63");



            fetch('/datosGPS')

            .then(response => response.json())

            .then(data => {

                let error_latitud = data.error_N;

                let error_longitud = data.error_E;

                let error_altitud = data.error_U;

                let valor_latitud = data.latitud;

                let valor_longitud = data.altitud;

                let valor_altitud = data.longitud;
                
                let fecha = data.fecha;
                
                let hora = data.hora;

				updateDataElements(data);



                if (data.error_N > margen1 && data.error_N <= margen2) {

                    rect12.style.backgroundColor = verde_osc; 

                    rect22.style.backgroundColor = verde;

                    rect32.style.backgroundColor = verde_cl; 

                    rect42.style.backgroundColor = amarillo; 

                    rect52.style.backgroundColor = naranja; 

                    rect62.style.backgroundColor = rojo; 

                } else if (data.error_N > margen2 && data.error_N <= margen3) {

                    rect12.style.backgroundColor = blanco; 

                    rect22.style.backgroundColor = verde;

                    rect32.style.backgroundColor = verde_cl; 

                    rect42.style.backgroundColor = amarillo; 

                    rect52.style.backgroundColor = naranja; 

                    rect62.style.backgroundColor = rojo; 

                } else if (data.error_N > margen3 && data.error_N <= margen4) {

                    rect12.style.backgroundColor = blanco; 

                    rect22.style.backgroundColor = blanco;

                    rect32.style.backgroundColor = verde_cl; 

                    rect42.style.backgroundColor = amarillo; 

                    rect52.style.backgroundColor = naranja; 

                    rect62.style.backgroundColor = rojo; 

                } else if (data.error_N > margen4 && data.error_N <= margen5) {

                    rect12.style.backgroundColor = blanco; 

                    rect22.style.backgroundColor = blanco;

                    rect32.style.backgroundColor = blanco; 

                    rect42.style.backgroundColor = amarillo; 

                    rect52.style.backgroundColor = naranja; 

                    rect62.style.backgroundColor = rojo; 

                } else if (data.error_N > margen5 && data.error_N <= margen6) {

                    rect12.style.backgroundColor = blanco; 

                    rect22.style.backgroundColor = blanco;

                    rect32.style.backgroundColor = blanco; 

                    rect42.style.backgroundColor = blanco; 

                    rect52.style.backgroundColor = naranja; 

                    rect62.style.backgroundColor = rojo; 

                } else {

                    rect12.style.backgroundColor = blanco; 

                    rect22.style.backgroundColor = blanco;

                    rect32.style.backgroundColor = blanco; 

                    rect42.style.backgroundColor = blanco; 

                    rect52.style.backgroundColor = blanco; 

                    rect62.style.backgroundColor = rojo; 

                }

                if (data.error_E > margen1 && data.error_E <= margen2) {

                    rect11.style.backgroundColor = verde_osc; 

                    rect21.style.backgroundColor = verde;

                    rect31.style.backgroundColor = verde_cl; 

                    rect41.style.backgroundColor = amarillo; 

                    rect51.style.backgroundColor = naranja; 

                    rect61.style.backgroundColor = rojo; 

                } else if (data.error_E > margen2 && data.error_E <= margen3) {

                    rect11.style.backgroundColor = blanco; 

                    rect21.style.backgroundColor = verde;

                    rect31.style.backgroundColor = verde_cl; 

                    rect41.style.backgroundColor = amarillo; 

                    rect51.style.backgroundColor = naranja; 

                    rect61.style.backgroundColor = rojo; 

                } else if (data.error_E > margen3 && data.error_E <= margen4) {

                    rect11.style.backgroundColor = blanco; 

                    rect21.style.backgroundColor = blanco;

                    rect31.style.backgroundColor = verde_cl; 

                    rect41.style.backgroundColor = amarillo; 

                    rect51.style.backgroundColor = naranja; 

                    rect61.style.backgroundColor = rojo; 

                } else if (data.error_E > margen4 && data.error_E <= margen5) {

                    rect11.style.backgroundColor = blanco; 

                    rect21.style.backgroundColor = blanco;

                    rect31.style.backgroundColor = blanco; 

                    rect41.style.backgroundColor = amarillo; 

                    rect51.style.backgroundColor = naranja; 

                    rect61.style.backgroundColor = rojo; 

                } else if (data.error_E > margen5 && data.error_E <= margen6) {

                    rect11.style.backgroundColor = blanco; 

                    rect21.style.backgroundColor = blanco;

                    rect31.style.backgroundColor = blanco; 

                    rect41.style.backgroundColor = blanco; 

                    rect51.style.backgroundColor = naranja; 

                    rect61.style.backgroundColor = rojo; 

                } else {

                    rect11.style.backgroundColor = blanco; 

                    rect21.style.backgroundColor = blanco;

                    rect31.style.backgroundColor = blanco; 

                    rect41.style.backgroundColor = blanco; 

                    rect51.style.backgroundColor = blanco; 

                    rect61.style.backgroundColor = rojo; 

                }

                if (data.error_U > margen1 && data.error_U <= margen2) {

                    rect13.style.backgroundColor = verde_osc; 

                    rect23.style.backgroundColor = verde;

                    rect33.style.backgroundColor = verde_cl; 

                    rect43.style.backgroundColor = amarillo; 

                    rect53.style.backgroundColor = naranja; 

                    rect63.style.backgroundColor = rojo; 

                } else if (data.error_U > margen2 && data.error_U <= margen3) {

                    rect13.style.backgroundColor = blanco; 

                    rect23.style.backgroundColor = verde;

                    rect33.style.backgroundColor = verde_cl; 

                    rect43.style.backgroundColor = amarillo; 

                    rect53.style.backgroundColor = naranja; 

                    rect63.style.backgroundColor = rojo; 

                } else if (data.error_U > margen3 && data.error_U <= margen4) {

                    rect13.style.backgroundColor = blanco; 

                    rect23.style.backgroundColor = blanco;

                    rect33.style.backgroundColor = verde_cl; 

                    rect43.style.backgroundColor = amarillo; 

                    rect53.style.backgroundColor = naranja; 

                    rect63.style.backgroundColor = rojo; 

                } else if (data.error_U > margen4 && data.error_U <= margen5) {

                    rect13.style.backgroundColor = blanco; 

                    rect23.style.backgroundColor = blanco;

                    rect33.style.backgroundColor = blanco; 

                    rect43.style.backgroundColor = amarillo; 

                    rect53.style.backgroundColor = naranja; 

                    rect63.style.backgroundColor = rojo; 

                } else if (data.error_U > margen5 && data.error_U <= margen6) {

                    rect13.style.backgroundColor = blanco; 

                    rect23.style.backgroundColor = blanco;

                    rect33.style.backgroundColor = blanco; 

                    rect43.style.backgroundColor = blanco; 

                    rect53.style.backgroundColor = naranja; 

                    rect63.style.backgroundColor = rojo; 

                } else {

                    rect13.style.backgroundColor = blanco; 

                    rect23.style.backgroundColor = blanco;

                    rect33.style.backgroundColor = blanco; 

                    rect43.style.backgroundColor = blanco; 

                    rect53.style.backgroundColor = blanco; 

                    rect63.style.backgroundColor = rojo; 

                }

            });

        }



        function updateColor() {

            fetch('/luz_gps')

                .then(response => response.json())

                .then(data => {

                    const color_gps = data.color_gps;

                    const color_spec = data.color_spec;

                    document.getElementById('circle').style.backgroundColor = color_gps;

                    document.getElementById('circle2').style.backgroundColor = color_spec;

                });

        }

        

        

        function validateRange() {

            var option1 = document.getElementById("option1");

            var option2 = document.getElementById("option2");

            var submitButton = document.getElementById("submit-button");

            if (parseFloat(option1.value) > parseFloat(option2.value)) {

                alert("Selecciona un rango vÃ¡lido");

                option1.selectedIndex = 0;

                option2.selectedIndex = option2.length - 1;

                submitButton.disabled = true;

            } else {

                submitButton.disabled = false;

            }

        }

    

        function updateFilter() {

            event.preventDefault();

    

            var option1 = document.getElementById('option1').value;

            var option2 = document.getElementById('option2').value;

            validateRange();

    

            fetch('/filter', {

                method: 'POST',

                headers: {

                    'Content-Type': 'application/x-www-form-urlencoded'

                },

                body: 'option1=' + option1 + '&option2=' + option2

            })

            .then(response => response.json())

            .then(data => {

                console.log(data.data);

                var filteredDataElement = document.getElementById('filtered-data');
                
                drawServerReceivedMessage('Rango de longitudes de onda actualizado');

            })

            .catch(error => {

                console.error('Error:', error);

            });

        }

        $(document).ready(function() {

			$('#checkbox-form').on('submit', function(event) {

				event.preventDefault();



				$.ajax({

					type: 'POST',

					url: '/get_selected',

					data: $(this).serialize(),

					success: function(response) {
						console.log($(this).serialize());
						
						drawServerReceivedMessage(response.filtered_data);

					},

					error: function(xhr, status, error) {

						console.error(error);

					}

				});

			});

		});

		$(document).ready(function() {

			const $startRecording = $('#start-recording');



			function updateRecordingButtonText() {

				fetch('/get_recording_status')

					.then(response => response.json())

					.then(data => {

						const isRecording = data.isRecording;

						$startRecording.text(isRecording ? 'Pausar registro' : 'Iniciar registro');

						$startRecording.data('recording', isRecording);
												
						if(isRecording){
							$startRecording.addClass("btn-danger");							
						}else
							$startRecording.removeClass("btn-danger");									
					})

					.catch(error => {

						console.error('Error:', error);

					});

			}



			setInterval(updateRecordingButtonText, 500);

			$startRecording.on('click', function() {

				let isRecording = $(this).data('recording');



				$.ajax({

					type: 'POST',

					url: '/start_recording',

					contentType: 'application/json',

					data: JSON.stringify({ recording: !isRecording }),

					success: function(response) {

						console.log('Recording status changed');

						updateRecordingButtonText();

					},

					error: function(xhr, status, error) {

						console.error('Error changing recording status:', error);

					}

				});

			});

		});

        function actualizarDatosGuardados() {

            $.ajax({

                url: '/get-datos-actualizados',

                type: 'GET',

                success: function(response) {

                    $('#datos-guardados').text(response.datosGuardados);

                    $('#tiempo-guardado').text(response.tiempoGuardado);

                    $('#tiempo-integracion').text(response.tiempoIntegracion);

                    $('#rangoi').text(response.rangoi);

                    $('#rangof').text(response.rangof);

                    $('#var_sel').text(response.var_sel);

                    

                },

                error: function(error) {

                    console.log(error);

                }

            });

        }

        $(document).ready(function() {

            $('#clear-csv-btn').on('click', function() {

                $.ajax({

                    type: 'POST',

                    url: '/clearcsv',

                    success: function(response) {

                    },

                    error: function(xhr, status, error) {

                        alert('Error al limpiar el contenido del CSV.');

                    }

                });

            });

        });

		//fetchAndUpdateSelectedFile();

		setInterval(fetchAndUpdateSelectedFile, 700);

        setInterval(actualizarDatosGuardados, 700);

        setInterval(updateColor, 500);

        setInterval(datosGPS_colores, 500);
		
    

    window.onload = function() {
		datosGPS_colores();
	};

    </script>

</body>

</html>
